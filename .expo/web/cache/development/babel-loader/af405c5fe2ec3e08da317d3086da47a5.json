{"ast":null,"code":"import _slicedToArray from \"@babel/runtime/helpers/slicedToArray\";\n\nvar _this = this,\n    _jsxFileName = \"F:\\\\Professionnel\\\\Formation\\\\3wacademy\\\\react\\\\reactnative\\\\drivev1\\\\api_front\\\\screen\\\\driveMap.js\";\n\nimport _regeneratorRuntime from \"@babel/runtime/regenerator\";\nimport React, { useState, useEffect } from 'react';\nimport StyleSheet from \"react-native-web/dist/exports/StyleSheet\";\nimport Text from \"react-native-web/dist/exports/Text\";\nimport View from \"react-native-web/dist/exports/View\";\nimport ImageBackground from \"react-native-web/dist/exports/ImageBackground\";\nimport TouchableOpacity from \"react-native-web/dist/exports/TouchableOpacity\";\nimport { widthPercentageToDP as wp, heightPercentageToDP as hp } from 'react-native-responsive-screen';\nimport { connect } from 'react-redux';\nimport MapView, { Marker, Callout } from 'react-native-maps';\nimport * as Location from 'expo-location';\nimport * as Permissions from 'expo-permissions';\nimport { getAllStore } from \"../api/map\";\n\nvar Map = function Map(props) {\n  var DEFAULT_COORD = {\n    coords: {\n      latitude: 48.85844,\n      longitude: 2.294555\n    }\n  };\n\n  var _useState = useState(DEFAULT_COORD),\n      _useState2 = _slicedToArray(_useState, 2),\n      location = _useState2[0],\n      setLocation = _useState2[1];\n\n  var _useState3 = useState([]),\n      _useState4 = _slicedToArray(_useState3, 2),\n      store = _useState4[0],\n      setStore = _useState4[1];\n\n  useEffect(function () {\n    getGeolocAsync();\n  }, []);\n\n  var getGeolocAsync = function getGeolocAsync() {\n    var _await$Permissions$as, status, myLocation;\n\n    return _regeneratorRuntime.async(function getGeolocAsync$(_context) {\n      while (1) {\n        switch (_context.prev = _context.next) {\n          case 0:\n            _context.next = 2;\n            return _regeneratorRuntime.awrap(Permissions.askAsync(Permissions.LOCATION));\n\n          case 2:\n            _await$Permissions$as = _context.sent;\n            status = _await$Permissions$as.status;\n            console.log(\"STATUS\", status);\n\n            if (!(status !== 'granted')) {\n              _context.next = 8;\n              break;\n            }\n\n            throw new Error('Location permission not granted');\n\n          case 8:\n            _context.next = 10;\n            return _regeneratorRuntime.awrap(Location.getCurrentPositionAsync({}));\n\n          case 10:\n            myLocation = _context.sent;\n            setLocation(myLocation);\n            console.log(\"location\", location);\n\n          case 13:\n          case \"end\":\n            return _context.stop();\n        }\n      }\n    }, null, null, null, Promise);\n  };\n\n  var essai = function essai() {\n    return _regeneratorRuntime.async(function essai$(_context2) {\n      while (1) {\n        switch (_context2.prev = _context2.next) {\n          case 0:\n            getAllStore(props.user.infos.token).then(function (response) {\n              setStore(response.result);\n            });\n\n          case 1:\n          case \"end\":\n            return _context2.stop();\n        }\n      }\n    }, null, null, null, Promise);\n  };\n\n  return React.createElement(ImageBackground, {\n    style: styles.imgBackground,\n    resizeMode: \"cover\",\n    source: require(\"../assets/bg3.jpg\"),\n    __self: _this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 58,\n      columnNumber: 7\n    }\n  }, React.createElement(View, {\n    style: styles.container,\n    __self: _this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 63,\n      columnNumber: 7\n    }\n  }, React.createElement(View, {\n    style: styles.header,\n    __self: _this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 64,\n      columnNumber: 9\n    }\n  }, React.createElement(Text, {\n    style: styles.title,\n    __self: _this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 65,\n      columnNumber: 11\n    }\n  }, \"G\\xE9olocalisation des magasins :\"), React.createElement(TouchableOpacity, {\n    style: styles.button,\n    onPress: function onPress(e) {\n      essai();\n    },\n    __self: _this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 66,\n      columnNumber: 11\n    }\n  }, React.createElement(Text, {\n    __self: _this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 72,\n      columnNumber: 13\n    }\n  }, \"Appuies ici\"))), location && React.createElement(MapView, {\n    style: {\n      flex: 2\n    },\n    region: {\n      latitude: location.coords.latitude,\n      longitude: location.coords.longitude,\n      latitudeDelta: 5,\n      longitudeDelta: 5\n    },\n    showsUserLocation: true,\n    scrollEnabled: true,\n    liteMode: false,\n    __self: _this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 75,\n      columnNumber: 24\n    }\n  }, store.map(function (stores) {\n    console.log(\"STORES\", stores);\n    return React.createElement(MapView.Marker, {\n      title: stores.name,\n      coordinate: {\n        latitude: parseFloat(stores.lat),\n        longitude: parseFloat(stores.lng)\n      },\n      key: stores.id,\n      __self: _this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 89,\n        columnNumber: 23\n      }\n    }, React.createElement(Callout, {\n      style: styles.markers,\n      __self: _this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 97,\n        columnNumber: 13\n      }\n    }, React.createElement(Text, {\n      __self: _this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 98,\n        columnNumber: 17\n      }\n    }, stores.name), React.createElement(Text, {\n      __self: _this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 99,\n        columnNumber: 17\n      }\n    }, stores.address, \" \", stores.zip, \" \", stores.city), React.createElement(Text, {\n      __self: _this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 100,\n        columnNumber: 17\n      }\n    }, stores.description)));\n  }))));\n};\n\nvar styles = StyleSheet.create({\n  container: {\n    flex: 1,\n    marginTop: 30\n  },\n  imgBackground: {\n    width: '100%',\n    height: '100%',\n    flex: 1\n  },\n  title: {\n    color: \"white\",\n    fontSize: 20\n  },\n  header: {\n    height: 100,\n    paddingTop: 10,\n    backgroundColor: '#17202a',\n    alignItems: \"center\",\n    justifyContent: \"center\"\n  },\n  button: {\n    width: wp('30%'),\n    height: wp('10%'),\n    borderRadius: 50,\n    marginTop: 5,\n    paddingLeft: 15,\n    paddingRight: 15,\n    backgroundColor: \"white\",\n    alignItems: \"center\",\n    justifyContent: \"center\"\n  },\n  markers: {}\n});\n\nmapStateToProps = function mapStateToProps(store) {\n  return {\n    user: store.user\n  };\n};\n\nexport default connect(mapStateToProps)(Map);","map":{"version":3,"sources":["F:/Professionnel/Formation/3wacademy/react/reactnative/drivev1/api_front/screen/driveMap.js"],"names":["React","useState","useEffect","widthPercentageToDP","wp","heightPercentageToDP","hp","connect","MapView","Marker","Callout","Location","Permissions","getAllStore","Map","props","DEFAULT_COORD","coords","latitude","longitude","location","setLocation","store","setStore","getGeolocAsync","askAsync","LOCATION","status","console","log","Error","getCurrentPositionAsync","myLocation","essai","user","infos","token","then","response","result","styles","imgBackground","require","container","header","title","button","e","flex","latitudeDelta","longitudeDelta","map","stores","name","parseFloat","lat","lng","id","markers","address","zip","city","description","StyleSheet","create","marginTop","width","height","color","fontSize","paddingTop","backgroundColor","alignItems","justifyContent","borderRadius","paddingLeft","paddingRight","mapStateToProps"],"mappings":"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","sourcesContent":["import React, {useState, useEffect} from 'react';\r\nimport { StyleSheet, Text, View, ImageBackground, TouchableOpacity} from 'react-native';\r\nimport {\r\n    widthPercentageToDP as wp,\r\n    heightPercentageToDP as hp,\r\n  } from 'react-native-responsive-screen';\r\nimport {connect} from 'react-redux';\r\nimport MapView, {Marker, Callout} from 'react-native-maps';\r\nimport * as Location from 'expo-location';\r\nimport * as Permissions from 'expo-permissions';\r\nimport {getAllStore} from '../api/map';\r\n\r\nconst Map = (props)=>{\r\n\r\n  //default location\r\n  const DEFAULT_COORD = {\r\n    coords: { //  Eiffel Tower\r\n      latitude: 48.85844,\r\n      longitude: 2.294555\r\n    }\r\n  }\r\n\r\n  const [location, setLocation] = useState(DEFAULT_COORD)\r\n  const [store, setStore] = useState([])\r\n\r\n  useEffect(()=>{\r\n    getGeolocAsync()\r\n  }, [])\r\n\r\n  const getGeolocAsync = async ()=>{\r\n\r\n    let { status } = await Permissions.askAsync(Permissions.LOCATION);\r\n    console.log(\"STATUS\",status)\r\n\r\n    if(status !== ('granted')){\r\n\r\n      throw new Error('Location permission not granted')\r\n      return\r\n\r\n  }\r\n\r\n    let myLocation = await Location.getCurrentPositionAsync({})\r\n    setLocation(myLocation);\r\n    console.log(\"location\",location)\r\n  }\r\n\r\n  const essai = async ()=>{\r\n\r\n    getAllStore(props.user.infos.token)\r\n    .then((response)=>{\r\n      //console.log(\"STORE\",response.result)\r\n      setStore(response.result)\r\n    })\r\n\r\n  }\r\n\r\n    return (\r\n      <ImageBackground \r\n        style={ styles.imgBackground } \r\n        resizeMode='cover' \r\n        source={require('../assets/bg3.jpg')}\r\n      >\r\n      <View style={styles.container}>\r\n        <View style={styles.header}>\r\n          <Text style={styles.title}>Géolocalisation des magasins :</Text>\r\n          <TouchableOpacity\r\n            style={styles.button}\r\n            onPress={(e)=>{\r\n                essai()\r\n              }}\r\n          >\r\n            <Text>Appuies ici</Text>\r\n          </TouchableOpacity>\r\n        </View>\r\n          {location && <MapView\r\n              style={{flex: 2}}\r\n              region={{\r\n                  latitude: location.coords.latitude,\r\n                  longitude: location.coords.longitude,\r\n                  latitudeDelta: 5,\r\n                  longitudeDelta: 5\r\n              }}\r\n              showsUserLocation = {true}\r\n              scrollEnabled={true}\r\n              liteMode={false}\r\n          >\r\n          {store.map((stores)=>{\r\n            console.log(\"STORES\",stores)\r\n              return (<MapView.Marker\r\n                  title={stores.name}\r\n                  coordinate={{\r\n                    latitude: parseFloat(stores.lat),\r\n                    longitude: parseFloat(stores.lng)\r\n                  }}\r\n                  key={stores.id}\r\n            >\r\n            <Callout style={styles.markers}>\r\n                <Text>{stores.name}</Text>\r\n                <Text>{stores.address} {stores.zip} {stores.city}</Text>\r\n                <Text>{stores.description}</Text>\r\n            </Callout>\r\n          </MapView.Marker>)\r\n                    }) }              \r\n          </MapView>}  \r\n      </View>       \r\n      </ImageBackground>\r\n    )\r\n}\r\n  \r\n  const styles = StyleSheet.create({\r\n      container: {\r\n        flex: 1,\r\n        marginTop: 30\r\n      },\r\n      imgBackground: {\r\n        width: '100%',\r\n        height: '100%',\r\n        flex: 1 \r\n      },\r\n      title: {\r\n        color: \"white\",\r\n        fontSize: 20\r\n      },\r\n      header: {\r\n        height: 100,\r\n        paddingTop: 10,\r\n        backgroundColor: '#17202a',\r\n        alignItems: \"center\",\r\n        justifyContent: \"center\",\r\n      },\r\n      button: {\r\n        width: wp('30%'),\r\n        height: wp('10%'),\r\n        borderRadius: 50,\r\n        marginTop: 5,\r\n        paddingLeft: 15,\r\n        paddingRight: 15,\r\n        backgroundColor: \"white\",\r\n        alignItems: \"center\",\r\n        justifyContent: \"center\"\r\n      },\r\n      markers: {\r\n        \r\n       \r\n      }\r\n    });\r\n  \r\n\r\nmapStateToProps = (store)=>{\r\n    return {\r\n        user: store.user\r\n    }\r\n}\r\nexport default connect(mapStateToProps)(Map);"]},"metadata":{},"sourceType":"module"}